[gd_scene load_steps=8 format=2]

[ext_resource path="res://Player.png" type="Texture" id=1]
[ext_resource path="res://luz.png" type="Texture" id=2]
[ext_resource path="res://DialogManager.tscn" type="PackedScene" id=3]

[sub_resource type="GDScript" id=2]

resource_name = "Player.gd"
script/source = "extends KinematicBody2D

export (int) var run_speed
export (int) var jump_speed
export (int) var gravity

enum {IDLE, RUN, JUMP}
var velocity = Vector2()
var state
var anim
var new_anim
var canMove = true
var dialog

func _ready():
	change_state(IDLE)
	rotation = 0
	pass

func change_state(new_state):
	state = new_state
	match state:
		IDLE:
			new_anim = 'idle'
		RUN:
			new_anim = 'run'
		JUMP:
			new_anim = 'jump_up'

func get_input():
	velocity.x = 0
	var right = Input.is_action_pressed('ui_right')
	var left = Input.is_action_pressed('ui_left')
	var jump = Input.is_action_just_pressed('ui_up')

	if jump and is_on_floor():
		change_state(JUMP)
		velocity.y = -jump_speed
	if right:
		change_state(RUN)
		velocity.x += run_speed
	if left:
		change_state(RUN)
		velocity.x -= run_speed
	if !right and !left and state == RUN:
		change_state(IDLE)

func _process(delta):
	if canMove:
		get_input()
		if new_anim != anim:
			anim = new_anim
	pass

func _physics_process(delta):
	velocity.y += gravity * delta
	if state == JUMP:
		if is_on_floor():
			change_state(IDLE)
	velocity = move_and_slide(velocity, Vector2(0, -1))

func play_dialog(dialogs,duration):
	$DialogManager.play(dialogs,duration)
	pass

func activate():
	canMove = true
	rotation = 0
	pass

func camera_close_up():
	$Camera/Anim.play(\"CameraZoomIn\")
	pass

func camera_away():
	$Camera/Anim.queue(\"CameraZoomOut\")
	pass"
_sections_unfolded = [ "Resource" ]

[sub_resource type="RectangleShape2D" id=1]

custom_solver_bias = 0.0
extents = Vector2( 16.0744, 16.0072 )

[sub_resource type="Animation" id=5]

resource_name = "CameraZoomIn"
length = 1.0
loop = false
step = 0.1
tracks/0/type = "value"
tracks/0/path = NodePath(".:zoom")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/keys = {
"times": PoolRealArray( 0, 1 ),
"transitions": PoolRealArray( 1, 1 ),
"update": 0,
"values": [ Vector2( 0.7, 0.7 ), Vector2( 0.5, 0.5 ) ]
}

[sub_resource type="Animation" id=6]

resource_name = "CameraZoomOut"
length = 1.0
loop = false
step = 0.1
tracks/0/type = "value"
tracks/0/path = NodePath(".:zoom")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/keys = {
"times": PoolRealArray( 0, 1 ),
"transitions": PoolRealArray( 1, 1 ),
"update": 0,
"values": [ Vector2( 0.5, 0.5 ), Vector2( 0.7, 0.7 ) ]
}

[node name="Player" type="KinematicBody2D" index="0"]

input_pickable = false
collision_layer = 1
collision_mask = 1
collision/safe_margin = 0.08
script = SubResource( 2 )
_sections_unfolded = [ "Visibility" ]
run_speed = 200
jump_speed = 400
gravity = 1000

[node name="Sprite" type="Sprite" parent="." index="0"]

texture = ExtResource( 1 )

[node name="CollisionShape2D" type="CollisionShape2D" parent="." index="1"]

shape = SubResource( 1 )

[node name="Light2D" type="Light2D" parent="." index="2"]

enabled = true
editor_only = false
texture = ExtResource( 2 )
offset = Vector2( 0, 0 )
texture_scale = 1.0
color = Color( 1, 1, 1, 1 )
energy = 1.0
mode = 0
range_height = 1.0
range_z_min = -1024
range_z_max = 1024
range_layer_min = 0
range_layer_max = 0
range_item_cull_mask = 1
shadow_enabled = true
shadow_color = Color( 0, 0, 0, 0 )
shadow_buffer_size = 2048
shadow_gradient_length = 0.0
shadow_filter = 0
shadow_filter_smooth = 0.0
shadow_item_cull_mask = 1
_sections_unfolded = [ "Range", "Shadow" ]

[node name="DialogManager" parent="." index="3" instance=ExtResource( 3 )]

[node name="Camera" type="Camera2D" parent="." index="4"]

anchor_mode = 1
rotating = false
current = true
zoom = Vector2( 0.7, 0.7 )
limit_left = -10000000
limit_top = -10000000
limit_right = 10000000
limit_bottom = 10000000
limit_smoothed = false
drag_margin_h_enabled = true
drag_margin_v_enabled = true
smoothing_enabled = true
smoothing_speed = 5.0
offset_v = 0.0
offset_h = 0.0
drag_margin_left = 0.1
drag_margin_top = 0.1
drag_margin_right = 0.1
drag_margin_bottom = 0.1
editor_draw_screen = true
editor_draw_limits = false
editor_draw_drag_margin = false
_sections_unfolded = [ "Drag Margin", "Offset", "Smoothing" ]

[node name="Anim" type="AnimationPlayer" parent="Camera" index="0"]

root_node = NodePath("..")
autoplay = ""
playback_process_mode = 1
playback_default_blend_time = 0.0
playback_speed = 1.0
anims/CameraZoomIn = SubResource( 5 )
anims/CameraZoomOut = SubResource( 6 )
blend_times = [  ]


